# å®ç°æ ‘ç»„ä»¶

### tree

æ‹†åˆ†ä¸ºæ ¹ç»“ç‚¹ï¼Œç»“ç‚¹å†…å®¹ï¼Œç”Ÿæˆå­èŠ‚ç‚¹

### æ ¹ç»“ç‚¹

```vue
<template>
  <div class="h-tree">
    <tree-node>
    </tree-node>
  </div>
</template>
```

props.dataä½œä¸ºå‚æ•°ä¼ ç»™é€’å½’ç»„ä»¶

å¯¹æ•°æ®è¿›è¡ŒåŠ å·¥ï¼Œè·å–åˆ°å…¶å®ƒçš„ä¿¡æ¯ï¼ˆå¦‚æ˜¯å¦å±•å¼€ç»“ç‚¹ç­‰ï¼‰å’Œè§£è€¦æ•°æ®

```js

let i  = ref<number>(0);
  const initFn = (data: any, level: number = 0) => {
  copyData.value = data.map((item: any, index: number) => {
    item.uid = i.value ++;//è®¡ç®—å”¯ä¸€æ ‡è¯†
    item.children = item[props.children] || []; //æŠŠå„¿å­èŠ‚ç‚¹ä¼ è¾“
    item.label = item[props.label];
    item.id = item[props.nodeKey];
    item.isOpen = false;
    item.isChecked = false;
    item.level = level;
    if (item.children && item.children.length) {
      initFn(item.children, level + 1);//è®¡ç®—å±‚çº§ï¼Œé€’å½’åŠ ä¸€
    }
    return {
      uid:item.uid,//å”¯ä¸€æ ‡è¯†
      id: item.id,
      label: item.label,//å†…å®¹
      children: item.children,
      isOpen: item.isOpen, //å±•å¼€
      isChecked: item.isChecked, //çˆ¶èŠ‚ç‚¹é€‰æ‹©æ¡†çš„çš„ä¸€ä¸ªåˆ¤æ–­
      disabled: item.disabled,//é»˜è®¤ç¦æ­¢ï¼Œæ²¡å†™ç›¸å…³åŠŸèƒ½å¯å¿½ç•¥
      level: item.level,//å±‚çº§
    };
  });
};
```

æŠŠæˆ‘ä»¬çš„æ–°æ•°æ®copydataä¼ å…¥å…¶ä¸­ï¼Œç„¶åæ¥é€’å½’ç”Ÿæˆç»“ç‚¹

```vue
<template>
  <div class="h-tree">
    <tree-node
      v-for="(item, index) in copyData"
      :key="index"
      :items="item"
      :label="label"
      :children="children"
      :show-checkbox="showCheckbox" 
      :index="0"
      :node-key="nodeKey"
      :default-expanded-keys="defaultExpandedKeys"
      :default-checked-keys="checkedKeys"
      :default-expand-all="defaultExpandAll"
      :render-content="renderContent"
      :parent-data="copyData">
    </tree-node>
  </div>
</template>

```

## ç”ŸæˆèŠ‚ç‚¹

```vue
<template>
 <div >
  <ul class="tree-node" >
  
    <div :class="['tree-node__content']"
     @click.stop="handleToggle(items)"
     :draggable="true"
     @dragstart="onDragStart"   
     @dragover="onDragOver"
     @drop="onDrop"
     @dragend="onDragEnd"
     >
      <span >
        <i class="icon iconfont icon-xiala"></i>
      </span>
      <el-checkbox
      v-if="showCheckbox"
      v-model="items!.isChecked" //å¤é€‰æ¡†æ£€æŸ¥
        :indeterminate="items.indeterminate"
        :disabled="items.disabled"
      @change="handleCheckChange"
      
      ></el-checkbox>
      <nodeContent :data="items" :render-content="renderContent" :parent-data="parentData" />
    </div>

      <div class="tree-ul-box" v-if="isShow" v-show="items.isOpen" > 
     
        <tree-node
          v-for="(i, j) in items.children"
          :key="j"
          :items="i"
          :uid="uid"
          :label="label"
          :children="children"
          :show-checkbox="showCheckbox"
          :index="index && index + 1"
          :node-key="nodeKey"
          :render-content="renderContent"
          :parent-data="items.children">
        </tree-node>
      </div>
  </ul>
</div>
```

#### 

ä½œä¸ºé€’å½’å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥æ¥æ”¶åˆšåˆšçˆ¶ç»„ä»¶çš„å‚æ•°,åŒæ ·æ˜¯ç”¨propsæ¥æ”¶

```js
const props = defineProps({
  items: {
    type: Object, 
    default: () => {},
  },
  label: String,
  children: String,
  showCheckbox: Boolean,
  index: Number,
  nodeKey: String,
  // é»˜è®¤å±•å¼€é¡¹
  defaultExpandedKeys: Array,
  // é»˜è®¤é€‰ä¸­é¡¹
  defaultCheckedKeys: Array,
  // é»˜è®¤å±•å¼€æ‰€æœ‰
  defaultExpandAll: Boolean,
  renderContent: Function,
  parentData: Array,
});



```

å¦‚æœæ”¹ç»“ç‚¹å­˜åœ¨å­èŠ‚ç‚¹æ‰èƒ½ç»§ç»­é€’å½’ï¼Œ å…·ä½“å®ç°å°±æ˜¯ç”¨v-ifæ¥åˆ¤æ–­å³å¯ã€‚

```js
const isShow = computed(() => {  return props.items.children && props.items.children.length; }); 
```

ç‚¹å‡»äº‹ä»¶,åˆ¤æ–­å±•å¼€

```js
const handleToggle = (item: any) => {
  item.isOpen = !item.isOpen;
  // å±•å¼€/æ”¶èµ·å­èŠ‚ç‚¹æ—¶è§¦å‘
};
```



## æ‰‹é£ç´æ¨¡å¼

```js
const handleToggle = (item: any) => {
  item.isOpen = !item.isOpen;
  // å±•å¼€/æ”¶èµ·å­èŠ‚ç‚¹æ—¶è§¦å‘
  if(item.isOpen) //å½“å‰èŠ‚ç‚¹å±•å¼€ï¼Œå°±å…³é—­åŒå±‚çº§èŠ‚ç‚¹
  {
    collapseOtherlevelNodes(item);  
  }
  toggleChange(item);
};

```



```js
const collapseOtherlevelNodes = (item: any)=>{
  collapseOtherlevelNodesFromParent (item,props.parentData?props.parentData:[]) 
}

```

ç”ŸæˆèŠ‚ç‚¹å‘æ ¹èŠ‚ç‚¹æ¥æ”¶collapse-other-level-nodesæ–¹æ³•

```js
const collapseOtherlevelNodesFromParent = inject<(currentNode: any, parentData: any[]) => void>("collapse-other-level-nodes", () => {});


```

æ ¹èŠ‚ç‚¹

```js
const collapseOtherlevelNodes=(currentNode: any, parentData: any[])=>{  
  const collapselevelNodes = (nodes: any[]) => { 
    nodes.forEach((node: any) => {
      // console.log("node.level",node.level);
      // console.log("currennt",currentNode);
     if (node.level === currentNode.level && node.uid !== currentNode.uid) {  //åŒå±‚çº§ä½†æ˜¯ä¸åŒidçš„èŠ‚ç‚¹ä¼šå…³é—­
        node.isOpen = false;
      }
      if (node.children && node.children.length) { //æ£€æŸ¥èŠ‚ç‚¹è¿˜æœ‰æ²¡æœ‰å„¿å­èŠ‚ç‚¹
        collapselevelNodes(node.children); //æœ‰å°±é€’å½’
      }
 
    });
  };
  collapselevelNodes(parentData); //é€’å½’è°ƒç”¨

}



```







## å¤é€‰æ¡†å®ç°

```vue
 <div >
  <ul class="tree-node" >
  
    <div :class="['tree-node__content']"
     @click.stop="handleToggle(items)"
     :draggable="true"
     @dragstart="onDragStart" 
     @dragover="onDragOver"
     @drop="onDrop"
     @dragend="onDragEnd"
     >
      <span >
        <i class="icon iconfont icon-xiala"></i>
      </span>
      <el-checkbox
      v-if="showCheckbox"
      v-model="items!.isChecked"
        :indeterminate="items.indeterminate"
        :disabled="items.disabled"
      @change="handleCheckChange"
      
      ></el-checkbox>
      <nodeContent :data="items" :render-content="renderContent" :parent-data="parentData" />
    </div>

      <div class="tree-ul-box" v-if="isShow" v-show="items.isOpen" >
     
        <tree-node
          v-for="(i, j) in items.children"
          :key="j"
          :items="i"
          :uid="uid"
          :level="level"
          :label="label"
          :children="children"
          :show-checkbox="showCheckbox"
          :index="index && index + 1"
          :node-key="nodeKey"
          :render-content="renderContent"
          :parent-data="items.children">
        </tree-node>
      </div>
  </ul>
</div>
```





### checkboxç‚¹å‡»äº‹ä»¶

## 1.è¯¥èŠ‚ç‚¹çš„çŠ¶æ€å˜åŒ–ï¼Œå…¶å­èŠ‚ç‚¹éœ€è¦å…¨éƒ¨æ”¹å˜

```
// é€‰ä¸­ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œé€’å½’åœ°éå†ä¸‹é¢æ‰€å±çš„æ‰€æœ‰å­èŠ‚ç‚¹
const updateChildChecked = (item: any, val: any) => {
  item.isChecked = val;
  if (item.children && item.children.length) {
    item.children.forEach((el: any) => {
      updateChildChecked(el, val);
    });
  }
};
```

### **2.åŒæ—¶çˆ¶çº§çš„çŠ¶æ€éœ€è¦æ ¹æ®å­èŠ‚ç‚¹æ˜¯å¦å…¨é€‰ï¼Œç­‰å‘ç”Ÿå˜åŒ–**

```js

// å­æœ‰ä¸€ä¸ªé€‰ä¸­ï¼Œçˆ¶ä¸ºåŠé€‰
// å­å…¨é€‰ä¸­ï¼Œçˆ¶ä¸ºå…¨é€‰
// å­ä¸€ä¸ªéƒ½æ²¡é€‰ä¸­ï¼Œçˆ¶ä¸é€‰
const updateChecked = (data: any) => {
  data.forEach((item: any) => {
    let checked;//é€‰ä¸­
    let indeterminate;//åŠé€‰
    let checkedNodes;
    if (item.children && item.children.length) {
      updateChecked(item.children);
      const children = item.children;
      // è¿‡æ»¤å‡ºé€‰ä¸­çš„
      checkedNodes = children.filter((child: any) => child.isChecked);
      if (checkedNodes.length === 0) {
        checked = false; 
        indeterminate = false; 
      } else if (checkedNodes.length === children.length) {
        checked = true;
        indeterminate = false;
      } else {
        checked = false;
        indeterminate = true;
      }
      item.isChecked = checked;
      item.indeterminate = indeterminate;
    }
  });
};
```



## æ‹–æ‹½å®ç°ï¼ˆç”ŸæˆèŠ‚ç‚¹ï¼‰

```js
const onDragStart = (event:any) => {
  event.dataTransfer.setData('item', JSON.stringify(props.items)); //å½“å‰æ‹–æ‹½èŠ‚ç‚¹çš„ä¿¡æ¯è®¾ç½®ä¼ é€’ç”¨itemçš„åç§°
  const droppedItem = JSON.parse(event.dataTransfer.getData('item'));//è·å–ä¿¡æ¯
  console.log("å½“å‰æ‹–æ‹½èŠ‚ç‚¹çš„parentData",props.parentData);

  const updatedData = removeNode(droppedItem, props.parentData);
  const proxy = new Proxy (updatedData,{});//å› ä¸ºprops.item.parentDataæ˜¯proxyç±»å‹ï¼Œæ‰€ä»¥èµ‹å€¼è¦è½¬æ¢ç±»å‹
  event.target.classList.add("dragging");//è®¾ç½®css
  if (updatedData) {
    nextTick(() => {
    props.items.parentData = proxy;//æ›´æ–°äº†å°±èµ‹å€¼
  });
  }
};

```



```js
const onDragOver = (event:any) => {
  event.preventDefault();
};

const onDrop = (event:any) => {
  event.preventDefault();
  const droppedItem = JSON.parse(event.dataTransfer.getData('item'));

 
 
  if (!props.items.children) {
    props.items.children = [];
  }
 
  console.log(props.items.children);
  props.items.children = [...props.items.children, droppedItem];//æ·»åŠ 
  props.items.isOpen = true; // å±•å¼€ç›®æ ‡èŠ‚ç‚¹

collapseOtherNodes(props.items); // æ”¶ç¼©å…¶ä»–èŠ‚ç‚¹


};

const onDragEnd = (event:any) => {
  event.dataTransfer.clearData('item');
  event.target.classList.remove("dragging");
};

```



### æœªè§£å†³

![Snipaste_2023-04-12_15-00-43](E:\æˆ‘çš„ç”µè„‘\Snipaste_2023-04-12_15-00-43.png)

å½“æˆ‘å†ä¸€æ¬¡æ›´æ–°è§†å›¾æ—¶ç»“æœæ­£ç¡®

![Snipaste_2023-04-12_15-01-53](E:\æˆ‘çš„ç”µè„‘\Snipaste_2023-04-12_15-01-53.png)

### ç»“ç‚¹å†…å®¹

ç»“ç‚¹å†…å®¹å…¶å®éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æ¥æ”¶ç»“ç‚¹çš„æ•°æ®ï¼Œç”¨è™šæ‹Ÿç»“ç‚¹çš„æ–¹å¼è¿”å›å³å¯ã€‚

```vue
<script lang="ts">
import { h, toRefs, reactive } from "vue";
export default {
  props: {
    data: {
      type: Object,
      required: true,
    },
    renderContent: Function,
    parentData: Array,
  },
  setup(props) {
    const { data, renderContent, parentData } = toRefs(props);
    const nodeData = reactive({
      data: data.value,
      parentData: parentData.value,
    });
    return () => [renderContent.value ? renderContent.value(h, nodeData) : h("span", data.value.label)];
  },
};
</script>

```



ç»“æœï¼š

![image-20230412160418590](C:\Users\86191\AppData\Roaming\Typora\typora-user-images\image-20230412160418590.png)

![image-20230412160449105](C:\Users\86191\AppData\Roaming\Typora\typora-user-images\image-20230412160449105.png)

![image-20230412160516432](C:\Users\86191\AppData\Roaming\Typora\typora-user-images\image-20230412160516432.png)

![image-20230412160534391](C:\Users\86191\AppData\Roaming\Typora\typora-user-images\image-20230412160534391.png)

å‚è€ƒ

[Vueå®ç°ä¸€ä¸ªTreeç»„ä»¶ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/6910584102974881799)

[HTML5æ‹–æ‹½APIå®ç°vueæ ‘å½¢æ‹–æ‹½ç»„ä»¶ - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/6844903604437041160)

[ChaiMayor/hview-ui: Hview UI - A Vue.js 3 UI library ğŸ‘» (github.com)](https://github.com/ChaiMayor/hview-ui)



